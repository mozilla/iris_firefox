# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this file,
# You can obtain one at http://mozilla.org/MPL/2.0/.


from targets.firefox.fx_testcase import *


class Test(FirefoxTest):

    @pytest.mark.details(
        description='Warning pages are displayed if websites suspected of phishing or malware are accessed',
        locale=['en-US'],
        test_case_id='3954',
        test_suite_id='69',
    )
    def run(self, firefox):
        deceptive_site_logo_pattern = Pattern('deceptive_site_logo.png')

        navigate('http://www.itisatrap.org/firefox/its-a-trap.html')

        phishing_warning_page_displayed = exists(deceptive_site_logo_pattern, FirefoxSettings.SITE_LOAD_TIMEOUT)
        assert phishing_warning_page_displayed, 'Phishing warning page is displayed'

        edit_select_all()

        edit_copy()

        text_displayed = get_clipboard().replace('\n', '').replace('\r', '')
        assert 'Deceptive site ahead' in text_displayed, 'A warning page is displayed, stating: Deceptive site ahead.'

        new_tab()

        previous_tab()

        close_tab()

        navigate('http://www.itisatrap.org/firefox/its-an-attack.html')

        malware_warning_page_displayed = exists(deceptive_site_logo_pattern, FirefoxSettings.SITE_LOAD_TIMEOUT)
        assert malware_warning_page_displayed, 'Malware warning page is displayed'

        edit_select_all()

        edit_copy()

        text_displayed = get_clipboard().replace('\n', '').replace('\r', '')
        assert 'Visiting this website may harm your computer' in text_displayed, \
            'A warning page is displayed stating: Visiting this website may harm your computer.'
